# About

This package is an interface to [CDAWeb's](https://cdaweb.gsfc.nasa.gov) metadata.

It was originally developed for upgrading the metadata from CDAWeb's HAPI servers.

The code reads and combines metadata from

* https://spdf.gsfc.nasa.gov/pub/catalogs/all.xml, which has top-level info about ~2,500 datasets.
* The "Master CDF" files referenced in all.xml, which contain global dataset metadata and variable metadata.
* The list of URLs associated with all CDF files associated with a dataset
* SPASE records referenced in the Master CDF files

In addition, this code computes the cadence of the measurements for each dataset by sampling the last CDF file associated with the dataset and computing a histogram of the differences in timesteps.

The output is

1. HAPI metadata
2. SQL tables, and a search interface, for metadata for
  * [CDAWeb variables](https://hapi-server.org/meta/cdaweb/) (~2,500)
  * [CDAWeb datasets](https://hapi-server.org/meta/cdaweb/dataset/) (~100,000)
  * [HAPI parameters](https://hapi-server.org/meta/hapi/) (~100,000)
  * [SPASE parameters](https://hapi-server.org/meta/spase/)

Metadata used or generated by this code is available at http://mag.gmu.edu/git-data/cdawmeta/data and is updated daily. The content includes

1. [Cached all.xml]()
2. [Cached Masters]()
3. [Cached dataset file lists]()
4. [Cached SPASE]()
5. [HAPI metadata]()
6. [SQL Tables]() used as the back-end for the SQL table links given above

and diffs if the content changes. Content is only updated if needed (based on HTTP headers).

# Running

```
git clone https://github.com/rweigel/cdawmeta.git
cd cdawmeta
make hapi
```

See the comments in `Makefile` for additional execution options.

The Makefile command above executes the following

```
python cdaweb.py         # creates data/cdaweb.json
python hapi/hapi-new.py  # creates data/hapi/hapi-new.json and
                         # data/info/*.json using data/catalog-all.json
```

# Compare

To compare the new HAPI metadata with Nand's, first execute `cdaweb.py` then

```
python hapi/hapi-nl.py   # creates data/hapi/catalog-all.nl.json using requests to
                         # https://cdaweb.gsfc.nasa.gov/hapi/{catalog,info}
make compare [--include='PATTERN'] # creates data/hapi/compare.log
# PATTERN is a dataset ID regular expression, e.g., '^AC_'
```

# Browse and Search

See `table/README.md` for browsing and searching metadata from a web interface.
